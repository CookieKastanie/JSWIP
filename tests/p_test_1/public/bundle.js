!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(){i.instance||(i.instance=this,this.onInit(()=>{}),this.onTick(()=>{}),this.onDraw(()=>{}),i.mouse=()=>{},i.gamepad=()=>{},i.run=!1,i.tickStart=0,i.drawStart=0,this.setDeltaLimite(1/15))}onInit(t){i.init=t}onTick(t){i.tickCallback=()=>{t(),i.tick=i.now-i.tickStart}}onDraw(t){i.drawCallback=()=>{t(),i.draw=i.now-i.drawStart}}async start(){if(i.run)return;await i.init(),i.run=!0;const t=e=>{i.now=e/1e3,i.delta=(i.now-i.lastTime)*i.scale,i.limitedDelta=i.delta>i.maxDelta?i.maxDelta:i.delta,i.fps=Math.floor(1/i.delta*100)/100,i.lastTime=i.now,i.gamepad(),i.tickFunc(),i.drawFunc(),i.mouse(),requestAnimationFrame(t)};requestAnimationFrame(e=>{i.lastTime=e/1e3,i.now=i.lastTime,this.play(),requestAnimationFrame(t)})}setScale(t){i.scale=t}setDeltaLimite(t){i.maxDelta=t}pause(){this.pauseTick(),this.pauseDraw()}play(){this.playTick(),this.playDraw()}pauseTick(){i.tickFunc=()=>{}}playTick(){i.tickFunc=i.tickCallback,i.tickStart=i.now-i.tick}pauseDraw(){i.drawFunc=()=>{}}playDraw(){i.drawFunc=i.drawCallback,i.drawStart=i.now-i.draw}}i.delta=0,i.limitedDelta=0,i.lastTime=0,i.scale=1,i.fps=0,i.now=0,i.tick=0,i.draw=0;class r{static calculate(t){t.currentTime+=i.delta*t.delta,t.currentTime>=t.end&&(t.currentTime=t.end)}}class n{static calculate(t){for(t.currentTime+=i.delta*t.delta;t.currentTime>=t.end;)t.currentTime-=t.diff}}class a{constructor(t=0,e=10,s=1){this.start=t,this.end=e,this.delta=s,this.diff=e-t,this.setLoop(!0),this.reset()}setLoop(t){this.state=t?n:r}next(){this.state.calculate(this),this.tic=Math.floor(this.currentTime)}getValue(){return this.tic}isFirst(){return this.currentTime==this.start}reset(){this.currentTime=this.start,this.tic=this.start}}class o{constructor(t=300,e=300,s={webGLVersion:1}){if(o.ctx)throw"Display est un singleton -> qu'un seul canevas à la fois.";if(this.canvas=document.createElement("canvas"),this.canvas.id="webgl-canvas",this.conteneur=document.getElementById("webgl-screen"),!this.conteneur)throw'Impossible de créer le canevas, il faut ajouter une balise avec l\'id "webgl-screen"';if(this.conteneur.appendChild(this.canvas),this.ctx=this.canvas.getContext(2==s.webGLVersion?"webgl2":"webgl"),this.ctx||(this.ctx=this.canvas.getContext("experimental-webgl")),!this.ctx)throw"Impossible de d'initialiser le contexte WebGL";this.loadExtensions(),this.use(),this.setSize(t,e),this.ctx.enable(this.ctx.DEPTH_TEST),this.setClearColor(Math.random(),Math.random(),Math.random(),1),this.ctx.enable(this.ctx.BLEND),this.ctx.enable(this.ctx.SAMPLE_ALPHA_TO_COVERAGE),this.defaultBlendFunc(),this.ctx.enable(this.ctx.CULL_FACE),this.ctx.frontFace(this.ctx.CCW),this.ctx.cullFace(this.ctx.BACK),this.clear()}loadExtensions(){this.exts={WEBGL_depth_texture:this.ctx.getExtension("WEBGL_depth_texture")}}getDiv(){return this.conteneur}setSize(t,e){this.canvas.width=t,this.canvas.height=e,this.ctx.viewport(0,0,t,e)}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}setClearColor(t,e,s,i){this.ctx.clearColor(t,e,s,i)}clear(){this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT)}clearColor(){this.ctx.clear(this.ctx.COLOR_BUFFER_BIT)}clearDepth(){this.ctx.clear(this.ctx.DEPTH_BUFFER_BIT)}getCtx(){return this.ctx}use(){o.ctx=this.getCtx()}useDefaultFrameBuffer(){this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),this.ctx.bindRenderbuffer(this.ctx.RENDERBUFFER,null),this.ctx.viewport(0,0,this.getWidth(),this.getHeight())}enable(t){this.ctx.enable(this.ctx[t])}disable(t){this.ctx.disable(this.ctx[t])}blendFunc(t,e){this.ctx.blendFunc(this.ctx[t],this.ctx[e])}defaultBlendFunc(){this.ctx.blendFunc(this.ctx.SRC_ALPHA,this.ctx.ONE_MINUS_SRC_ALPHA)}blendFuncSeparate(t,e,s,i){this.ctx.blendFuncSeparate(this.ctx[t],this.ctx[e],this.ctx[s],this.ctx[i])}getCanvas(){return this.canvas}}o.ctx=null,o.BLEND="BLEND",o.CULL_FACE="CULL_FACE",o.DEPTH_TEST="DEPTH_TEST",o.DITHER="DITHER",o.POLYGON_OFFSET_FILL="POLYGON_OFFSET_FILL",o.SAMPLE_ALPHA_TO_COVERAGE="SAMPLE_ALPHA_TO_COVERAGE",o.SAMPLE_COVERAGE="SAMPLE_COVERAGE",o.SCISSOR_TEST="SCISSOR_TEST",o.STENCIL_TEST="STENCIL_TEST",o.ZERO="ZERO",o.ONE="ONE",o.SRC_COLOR="SRC_COLOR",o.ONE_MINUS_SRC_COLOR="ONE_MINUS_SRC_COLOR",o.DST_COLOR="DST_COLOR",o.ONE_MINUS_DST_COLOR="ONE_MINUS_DST_COLOR",o.SRC_ALPHA="SRC_ALPHA",o.ONE_MINUS_SRC_ALPHA="ONE_MINUS_SRC_ALPHA",o.DST_ALPHA="DST_ALPHA",o.ONE_MINUS_DST_ALPHA="ONE_MINUS_DST_ALPHA",o.CONSTANT_COLOR="CONSTANT_COLOR",o.ONE_MINUS_CONSTANT_COLOR="ONE_MINUS_CONSTANT_COLOR",o.CONSTANT_ALPHA="CONSTANT_ALPHA",o.ONE_MINUS_CONSTANT_ALPHA="ONE_MINUS_CONSTANT_ALPHA",o.SRC_ALPHA_SATURATE="SRC_ALPHA_SATURATE";class c{constructor(t){this.pointer=o.ctx.createBuffer(),this.dataLength=-1,this.setUsage(t)}setUsage(t=c.STATIC_DRAW){return this.usage=o.ctx[t],this}delete(){o.ctx.deleteBuffer(this.pointer)}}class h extends c{constructor(t,e,s,i){super(i),this.attribLocation=s,this.nbOfElement=e,this.setData=h.prototype.setNewData,t&&(void 0!==t.BYTES_PER_ELEMENT?this.setData(t):this.setData(new Float32Array(t)))}setData(t,e=0){}setNewData(t){o.ctx.bindBuffer(o.ctx.ARRAY_BUFFER,this.pointer),o.ctx.bufferData(o.ctx.ARRAY_BUFFER,t,this.usage),this.dataLength=t.length,this.setData=h.prototype.setSubData}setSubData(t,e=0){o.ctx.bindBuffer(o.ctx.ARRAY_BUFFER,this.pointer),o.ctx.bufferSubData(o.ctx.ARRAY_BUFFER,e*Float32Array.BYTES_PER_ELEMENT,t)}getDataLength(){return this.dataLength/this.nbOfElement}use(){o.ctx.bindBuffer(o.ctx.ARRAY_BUFFER,this.pointer),o.ctx.vertexAttribPointer(this.attribLocation,this.nbOfElement,o.ctx.FLOAT,o.ctx.FALSE,0,0)}}class l extends c{constructor(t,e){super(e),this.setData=l.prototype.setNewData,t&&(void 0!==t.BYTES_PER_ELEMENT?this.setData(t):this.setData(new Uint16Array(t)))}setData(){}setNewData(t){o.ctx.bindBuffer(o.ctx.ELEMENT_ARRAY_BUFFER,this.pointer),o.ctx.bufferData(o.ctx.ELEMENT_ARRAY_BUFFER,t,this.usage),this.dataLength=t.length,this.setData=l.prototype.setSubData}setSubData(t,e=0){o.ctx.bindBuffer(o.ctx.ELEMENT_ARRAY_BUFFER,this.pointer),o.ctx.bufferSubData(o.ctx.ELEMENT_ARRAY_BUFFER,e,t)}getDataLength(){return this.dataLength}use(){o.ctx.bindBuffer(o.ctx.ELEMENT_ARRAY_BUFFER,this.pointer)}}l.STATIC_DRAW=h.STATIC_DRAW=c.STATIC_DRAW="STATIC_DRAW",l.DYNAMIC_DRAW=h.DYNAMIC_DRAW=c.DYNAMIC_DRAW="DYNAMIC_DRAW",l.STREAM_DRAW=h.STREAM_DRAW=c.STREAM_DRAW="STREAM_DRAW";class d{constructor(t,e){this.id=u.idMax++,this.width=t,this.height=e,this.texture=o.ctx.createTexture(),this.setUnit(0),this.use(),this.setParameters()}getWidth(){return this.width}getHeight(){return this.height}setUnit(t){return this.unit=t,this}getUnit(){return this.unit}use(){u.currentIds[this.unit]!=this.id&&(u.currentIds[this.unit]=this.id,o.ctx.activeTexture(o.ctx.TEXTURE0+this.unit),o.ctx.bindTexture(o.ctx.TEXTURE_2D,this.texture))}getLocation(){return this.texture}isPowerOf2(t){return 0==(t&t-1)}setParameters(t={magFilter:u.LINEAR,minFilter:u.LINEAR,wrapS:u.REPEAT,wrapT:u.REPEAT}){return t={magFilter:t.magFilter||u.LINEAR,minFilter:t.minFilter||u.LINEAR,wrapS:t.wrapS||u.REPEAT,wrapT:t.wrapT||u.REPEAT},this.isPowerOf2(this.width)&&this.isPowerOf2(this.height)?(o.ctx.generateMipmap(o.ctx.TEXTURE_2D),o.ctx.texParameterf(o.ctx.TEXTURE_2D,o.ctx.TEXTURE_MAG_FILTER,o.ctx[t.magFilter]),o.ctx.texParameterf(o.ctx.TEXTURE_2D,o.ctx.TEXTURE_MIN_FILTER,o.ctx[t.minFilter]),o.ctx.texParameteri(o.ctx.TEXTURE_2D,o.ctx.TEXTURE_WRAP_S,o.ctx[t.wrapS]),o.ctx.texParameteri(o.ctx.TEXTURE_2D,o.ctx.TEXTURE_WRAP_T,o.ctx[t.wrapT])):(o.ctx.texParameteri(o.ctx.TEXTURE_2D,o.ctx.TEXTURE_WRAP_S,o.ctx.CLAMP_TO_EDGE),o.ctx.texParameteri(o.ctx.TEXTURE_2D,o.ctx.TEXTURE_WRAP_T,o.ctx.CLAMP_TO_EDGE),o.ctx.texParameteri(o.ctx.TEXTURE_2D,o.ctx.TEXTURE_MIN_FILTER,o.ctx[t.minFilter]),o.ctx.texParameteri(o.ctx.TEXTURE_2D,o.ctx.TEXTURE_MAG_FILTER,o.ctx[t.magFilter])),this}delete(){o.ctx.deleteTexture(this.texture)}}class u extends d{constructor(t,e=t.width,s=t.height){super(e,s),null!=t?this.setTextureData(t):o.ctx.texImage2D(o.ctx.TEXTURE_2D,0,o.ctx.RGBA,this.width,this.height,0,o.ctx.RGBA,o.ctx.UNSIGNED_BYTE,null)}setTextureData(t){this.use(),o.ctx.texImage2D(o.ctx.TEXTURE_2D,0,o.ctx.RGBA,o.ctx.RGBA,o.ctx.UNSIGNED_BYTE,t)}}class x extends d{constructor(t,e){super(t,e),o.ctx.texImage2D(o.ctx.TEXTURE_2D,0,o.ctx.DEPTH_COMPONENT,this.width,this.height,0,o.ctx.DEPTH_COMPONENT,o.ctx.UNSIGNED_SHORT,null)}}u.idMax=0,u.currentIds=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],u.LINEAR="LINEAR",u.NEAREST="NEAREST",u.LINEAR_MIPMAP_LINEAR="LINEAR_MIPMAP_LINEAR",u.LINEAR_MIPMAP_NEAREST="LINEAR_MIPMAP_NEAREST",u.NEAREST_MIPMAP_NEAREST="NEAREST_MIPMAP_NEAREST",u.NEAREST_MIPMAP_LINEAR="NEAREST_MIPMAP_LINEAR",u.REPEAT="REPEAT",u.CLAMP_TO_EDGE="CLAMP_TO_EDGE",u.MIRRORED_REPEAT="MIRRORED_REPEAT";class m{constructor(t=256,e=256,s={texColor:!0,texColorUnit:0,depthTest:!0,texDepth:!1,texDepthUnit:0}){this.width=t,this.height=e,s={texColor:s.texColor||!1,texColorUnit:s.texColorUnit||0,texDepth:s.texDepth||!1,texDepthUnit:s.texDepthUnit||0,depthTest:s.depthTest||!1},this.textures={color:s.texColor?new u(null,t,e).setUnit(s.texColorUnit):null,depth:s.texDepth?new x(t,e).setUnit(s.texDepthUnit):null},this.frameBufferPointer=o.ctx.createFramebuffer(),this.depthBufferPointer=s.depthTest&&!s.texDepth?o.ctx.createRenderbuffer():null,this.use(),s.texColor&&o.ctx.framebufferTexture2D(o.ctx.FRAMEBUFFER,o.ctx.COLOR_ATTACHMENT0,o.ctx.TEXTURE_2D,this.textures.color.getLocation(),0),s.texDepth&&o.ctx.framebufferTexture2D(o.ctx.FRAMEBUFFER,o.ctx.DEPTH_ATTACHMENT,o.ctx.TEXTURE_2D,this.textures.depth.getLocation(),0),this.depthBufferPointer&&(o.ctx.renderbufferStorage(o.ctx.RENDERBUFFER,o.ctx.DEPTH_COMPONENT16,t,e),o.ctx.framebufferRenderbuffer(o.ctx.FRAMEBUFFER,o.ctx.DEPTH_ATTACHMENT,o.ctx.RENDERBUFFER,this.depthBufferPointer),o.ctx.bindRenderbuffer(o.ctx.RENDERBUFFER,null)),o.ctx.bindFramebuffer(o.ctx.FRAMEBUFFER,null)}use(){o.ctx.bindFramebuffer(o.ctx.FRAMEBUFFER,this.frameBufferPointer),null!=this.depthBufferPointer&&o.ctx.bindRenderbuffer(o.ctx.RENDERBUFFER,this.depthBufferPointer),o.ctx.viewport(0,0,this.width,this.height)}delete(){this.textures.color&&this.textures.color.delete(),this.textures.depth&&this.textures.depth.delete(),this.depthBufferPointer&&o.ctx.deleteRenderbuffer(this.depthBufferPointer),o.ctx.deleteFramebuffer(this.frameBufferPointer)}getTexture(){return this.textures.color}getColorTexture(){return this.textures.color}getDepthTexture(){return this.textures.depth}}class E{constructor(t,e,s="Shader"){if(this.name=s,this.program=null,this.attributList=new Object,this.attributNumber=0,this.uniformList=new Object,this.vertexShader=this.createShader(o.ctx.VERTEX_SHADER,t),!this.vertexShader)return;if(this.fragmantShader=this.createShader(o.ctx.FRAGMENT_SHADER,e),!this.fragmantShader)return;this.createProgramme();let i=null,r=0;const n=o.ctx.getProgramParameter(this.program,o.ctx.ACTIVE_UNIFORMS);for(;r<n;)i=o.ctx.getActiveUniform(this.program,r++),i&&this.initUniformLocation(i.name);this.attributNumber=o.ctx.getProgramParameter(this.program,o.ctx.ACTIVE_ATTRIBUTES)-1,E.attributeMax<this.attributNumber&&(E.attributeMax=this.attributNumber)}delShad(t){o.ctx.detacheShader(this.program,t),o.ctx.deleteShader(t)}createShader(t,e){const s=o.ctx.createShader(t);return o.ctx.shaderSource(s,e),o.ctx.compileShader(s),o.ctx.getShaderParameter(s,o.ctx.COMPILE_STATUS)?s:(console.error(this.name+" -> erreur de compilation "+(t==o.ctx.VERTEX_SHADER?"vertex":"fragment")+" shader!",o.ctx.getShaderInfoLog(s)),null)}createProgramme(){let t=o.ctx.createProgram();o.ctx.attachShader(t,this.vertexShader),o.ctx.attachShader(t,this.fragmantShader),o.ctx.linkProgram(t),o.ctx.getProgramParameter(t,o.ctx.LINK_STATUS)?(o.ctx.validateProgram(t),o.ctx.getProgramParameter(t,o.ctx.VALIDATE_STATUS)?this.program=t:console.error(this.name+" -> erreur de validation du programme",o.ctx.getProgramInfoLog(t))):console.error(this.name+" -> Impossible de lier le programme",o.ctx.getProgramInfoLog(t))}initUniformLocation(t){t=t.replace(/\[0\]/,"");const e=o.ctx.getUniformLocation(this.program,t);e?this.uniformList[t]=e:console.error("Uniform '"+t+"' n'existe pas dans "+this.name)}delete(){this.program&&(this.delShad(this.vertexShader),this.delShad(this.fragmantShader),o.ctx.deleteProgram(this.program),this.program=null)}use(){if(!this.program)return console.error(this.name+" -> Programme invalide");o.ctx.useProgram(this.program);for(let t=0;t<=E.attributeMax;++t)t<=this.attributNumber?o.ctx.enableVertexAttribArray(t):o.ctx.disableVertexAttribArray(t)}getAttribLocation(t){if(void 0===this.attributList[t]){const e=o.ctx.getAttribLocation(this.program,t);if(e<0)return void console.error("L'attribut '"+t+"' n'existe pas, ou il n'est pas utilisé dans "+this.name);this.attributList[t]=e}return this.attributList[t]}getUniformLocation(t){return this.uniformList[t]}sendFloat(t,e){o.ctx.uniform1f(this.getUniformLocation(t),e)}sendInt(t,e){o.ctx.uniform1i(this.getUniformLocation(t),e)}sendIntVec(t,e){o.ctx.uniform1iv(this.getUniformLocation(t),e)}sendVec1(t,e){o.ctx.uniform1fv(this.getUniformLocation(t),e)}sendVec2(t,e){o.ctx.uniform2fv(this.getUniformLocation(t),e)}sendVec3(t,e){o.ctx.uniform3fv(this.getUniformLocation(t),e)}sendVec4(t,e){o.ctx.uniform4fv(this.getUniformLocation(t),e)}sendMat2(t,e){o.ctx.uniformMatrix2fv(this.getUniformLocation(t),o.ctx.FALSE,e)}sendMat3(t,e){o.ctx.uniformMatrix3fv(this.getUniformLocation(t),o.ctx.FALSE,e)}sendMat4(t,e){o.ctx.uniformMatrix4fv(this.getUniformLocation(t),o.ctx.FALSE,e)}}E.attributeMax=-1;class f{constructor(t){this.id=f.idMax++,this.draw=f.prototype.drawVAO,this.setMode(t),this.vbos=new Array,this.vboNames=new Object}setMode(t=f.TRIANGLES){return this.mode=o.ctx[t],this}addVBO(t,e=this.vbos.length){const s=this.vbos.length;return this.vboNames[e]=s,this.vbos.push(t),this.refreshDataLength(),this}getVBO(t){return this.vbos[this.vboNames[t]]}use(){this.id!=f.currentId&&(this.useVBOs(),f.currentId=this.id)}refreshDataLength(){for(const t of this.vbos)if(this.dataLength=t.getDataLength(),this.dataLength<0)break}useVBOs(){for(const t of this.vbos)t.use()}drawCheck(){this.refreshDataLength(),this.dataLength>=0&&(this.draw=f.prototype.drawVAO,this.draw())}drawVAO(){this.use(),o.ctx.drawArrays(this.mode,0,this.dataLength)}delete(){for(const t of this.vbos)t.delete()}}f.idMax=0,f.currentId=-1;class T extends f{constructor(t,e){super(t),this.draw=T.prototype.drawCheck,e&&this.setIBO(e)}setIBO(t){return this.ibo=t,this.refreshDataLength(),this}getIBO(){return this.ibo}refreshDataLength(){this.ibo&&(this.nbIndex=this.ibo.getDataLength())}useVBOs(){this.ibo.use(),super.useVBOs()}draw(){}drawCheck(){this.refreshDataLength(),this.nbIndex>=0&&(this.draw=T.prototype.drawVAO,this.draw())}drawVAO(){this.use(),o.ctx.drawElements(this.mode,this.nbIndex,o.ctx.UNSIGNED_SHORT,0)}delete(){this.ibo&&this.ibo.delete(),super.delete()}}T.TRIANGLES=f.TRIANGLES="TRIANGLES",T.TRIANGLE_STRIP=f.TRIANGLE_STRIP="TRIANGLE_STRIP",T.TRIANGLE_FAN=f.TRIANGLE_FAN="TRIANGLE_FAN",T.POINTS=f.POINTS="POINTS",T.LINES=f.LINES="LINES",T.LINE_STRIP=f.LINE_STRIP="LINE_STRIP",T.LINE_LOOP=f.LINE_LOOP="LINE_LOOP";const p=(t,e)=>new Promise(s=>{null==t&&(t="Voulez vous activer l'audio sur cette page ?"),null==e&&(e="");const i=document.getElementsByTagName("head")[0],r=document.getElementsByTagName("body")[0],n=document.createElement("style");n.innerHTML="\n#bg {\n    left: 0; top: 0;\n    position: absolute;\n    background-color: #2d3436cc;\n    width: 100%;\n    height: 100%;\n}\n  \n#popup {\n    text-align: center;\n    -ms-user-select: none;\n    user-select: none;\n    \n    cursor: default;\n    font-family: \"Courier New\";\n    font-size: 1.2em;\n    color: #ecf0f1;\n    font-weight: bold;\n      \n    background-image: url(\"data:image/svg+xml;utf8, <svg xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 100 100' preserveAspectRatio='none'><path d='m0,30 l20,-30 l80,0 l0,70 l-20,30 l-80,0z' style='fill: %2334495e;'></path></svg>\");\n    \n    background-size: 100% 100%;\n    \n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin-top: -4em;\n    margin-left: -17em;\n    width: 30em;\n    height: 5em;\n    padding: 2em;\n}\n  \n#popup p {\n    margin-top: 0.5em;\n}\n  \n.btn {\n    font-size: 0.9em;\n    color: #011010;\n    font-family: \"Courier New\";\n    border: none;\n    padding: 0.5em;\n    font-weight: bold;\n}\n  \n.btn:hover {\n    cursor: pointer;\n}\n  \n#acc {\n    background-color: #2ecc71;\n    width: 60%;\n    margin-right: 0.5em;\n}\n  \n#acc:hover {\n    background-color: #3edc81;\n}\n  \n#ref {\n    background-color: #e74c3c;\n    width: 30%;\n}\n  \n#ref:hover {\n    background-color: #f75c4c;\n}";const a=document.createElement("div");a.id="bg";const o=document.createElement("div");o.id="popup";const c=document.createElement("p");c.innerHTML=t;const h=document.createElement("button");h.className="btn",h.id="acc",h.innerHTML="Accepter",h.onclick=()=>{_.ctx.resume().then(()=>{console.log("Contexte audio restauré ✅")}).catch(t=>{console.error(t)}),r.removeChild(a),r.removeChild(o),i.removeChild(n),s(!0)};const l=document.createElement("button");l.className="btn",l.id="ref",l.innerHTML="Refuser",l.onclick=()=>{r.removeChild(a),r.removeChild(o),i.removeChild(n),s(!1)},o.appendChild(c),o.appendChild(h),o.appendChild(l),i.appendChild(n),r.appendChild(a),r.appendChild(o)});class _{constructor(t=!0){if(_.ctx)throw"MainMixer est un singleton.";if(this.ctx=null,(window.AudioContext||window.webkitAudioContext)&&(this.ctx=new(window.AudioContext||window.webkitAudioContext)),!this.ctx)throw"Impossible de d'initialiser le contexte audio";t&&"running"!=this.ctx.state&&p(),_.ctx=this.ctx,_.mainGain=this.ctx.createGain(),_.mainGain.connect(this.ctx.destination),_.input=_.mainGain,this.setVolume(1),_.ctx.listener.forwardX?this.setPosition=_.prototype.setPosition_COMPATIBILITY_METHODE_1:this.setPosition=_.prototype.setPosition_COMPATIBILITY_METHODE_2}askPermission(){return"running"!=this.ctx.state?p():Promise.resolve(!0)}resume(){return _.ctx.resume()}setPosition_COMPATIBILITY_METHODE_1(t,e,s){_.ctx.listener.setPosition(t[0],t[1],t[2]),_.ctx.listener.forwardX.value=e[0],_.ctx.listener.forwardY.value=e[1],_.ctx.listener.forwardZ.value=e[2],_.ctx.listener.upX.value=s[0],_.ctx.listener.upY.value=s[1],_.ctx.listener.upZ.value=s[2]}setPosition_COMPATIBILITY_METHODE_2(t,e,s){_.ctx.listener.setPosition(t[0],t[1],t[2]),_.ctx.listener.setOrientation(e[0],e[1],e[2],s[0],s[1],s[2])}setPosition(t,e,s){}setVolume(t){_.mainGain.gain.value=t}getVolume(){_.mainGain.gain.value}}class A{constructor(){this.buffer=null,this.panner=_.ctx.createPanner(),this.panner.connect(_.input),this.panner.coneInnerAngle=360,this.currentSource=null}async loadData(t){return new Promise((e,s)=>{_.ctx.decodeAudioData(t,t=>{this.buffer=t,e(this)},t=>{console.error(t),s(this)})})}setPosition(t,e,s){this.panner.setPosition(t,e,s)}test(t){null!=this.currentSource&&(this.currentSource.playbackRate.value=t)}play(t=0,e=!1){const s=_.ctx.createBufferSource();s.buffer=this.buffer,s.loop=e,this.currentSource=s,s.connect(this.panner),s.start(_.ctx.currentTime+t)}}class g{constructor(){this.field=new Map}add(t,e,s){const i=g.coordToIndex(t,e);let r=this.field.get(i);r||(r=new Set,this.field.set(i,r)),r.add(s)}query(t,e,s=new Set){const i=g.coordToIndex(t,e),r=this.field.get(i);if(r)for(let t of r)s.add(t);return s}static coordToIndex(t,e){return Math.floor(t)*g.MAX_FIELD_VALUE+Math.floor(e)}clearAll(){this.field.clear()}}g.MAX_FIELD_VALUE=Math.floor(Math.sqrt(Number.MAX_SAFE_INTEGER/2)),g.MIN_FIELD_VALUE=-g.MAX_FIELD_VALUE;class R{static addToField(t,e,s,i,r=new g,n){R.currentField=r;const a=s>t,o=i>e,c=a^o?1:0;a?R._lookX(t,e,s,i,0,n):R._lookX(s,i,t,e,c,n),o?R._lookY(t,e,s,i,0,n):R._lookY(s,i,t,e,c,n)}static _lookX(t,e,s,i,r,n){R.currentField.add(t,e,n);const a=(i-e)/(s-t);for(let i=Math.floor(t)+1;i<=s;++i){const s=a*(i-t)+e;R.currentField.add(i-r,s,n)}}static _lookY(t,e,s,i,r,n){R.currentField.add(t,e,n);const a=(s-t)/(i-e);for(let s=Math.floor(e)+1;s<=i;++s){const i=a*(s-e)+t;R.currentField.add(i,s-r,n)}}}R.currentField=null;class L{static identity(t=new Float32Array(16)){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static lookAt(t,e,s,i){let r,n,a,o,c,h,l,d,u,x,m=e[0],E=e[1],f=e[2],T=i[0],p=i[1],_=i[2],A=s[0],g=s[1],R=s[2];return Math.abs(m-A)<L.EPSILON&&Math.abs(E-g)<L.EPSILON&&Math.abs(f-R)<L.EPSILON?L.identity(t):(l=m-A,d=E-g,u=f-R,x=1/Math.sqrt(l*l+d*d+u*u),l*=x,d*=x,u*=x,r=p*u-_*d,n=_*l-T*u,a=T*d-p*l,x=Math.sqrt(r*r+n*n+a*a),x?(x=1/x,r*=x,n*=x,a*=x):(r=0,n=0,a=0),o=d*a-u*n,c=u*r-l*a,h=l*n-d*r,x=Math.sqrt(o*o+c*c+h*h),x?(x=1/x,o*=x,c*=x,h*=x):(o=0,c=0,h=0),t[0]=r,t[1]=o,t[2]=l,t[3]=0,t[4]=n,t[5]=c,t[6]=d,t[7]=0,t[8]=a,t[9]=h,t[10]=u,t[11]=0,t[12]=-(r*m+n*E+a*f),t[13]=-(o*m+c*E+h*f),t[14]=-(l*m+d*E+u*f),t[15]=1,t)}static perspective(t,e,s,i,r){let n=1/Math.tan(e/2),a=1/(i-r);return t[0]=n/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*a,t[15]=1,t}static ortho(t,e,s,i,r,n,a){let o=1/(e-s),c=1/(i-r),h=1/(n-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+s)*o,t[13]=(r+i)*c,t[14]=(a+n)*h,t[15]=1,t}static multiply(t,e,s){const i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],c=e[5],h=e[6],l=e[7],d=e[8],u=e[9],x=e[10],m=e[11],E=e[12],f=e[13],T=e[14],p=e[15];let _=s[0],A=s[1],g=s[2],R=s[3];return t[0]=_*i+A*o+g*d+R*E,t[1]=_*r+A*c+g*u+R*f,t[2]=_*n+A*h+g*x+R*T,t[3]=_*a+A*l+g*m+R*p,_=s[4],A=s[5],g=s[6],R=s[7],t[4]=_*i+A*o+g*d+R*E,t[5]=_*r+A*c+g*u+R*f,t[6]=_*n+A*h+g*x+R*T,t[7]=_*a+A*l+g*m+R*p,_=s[8],A=s[9],g=s[10],R=s[11],t[8]=_*i+A*o+g*d+R*E,t[9]=_*r+A*c+g*u+R*f,t[10]=_*n+A*h+g*x+R*T,t[11]=_*a+A*l+g*m+R*p,_=s[12],A=s[13],g=s[14],R=s[15],t[12]=_*i+A*o+g*d+R*E,t[13]=_*r+A*c+g*u+R*f,t[14]=_*n+A*h+g*x+R*T,t[15]=_*a+A*l+g*m+R*p,t}static fromRotation(t,e,s){let i,r,n,a=s[0],o=s[1],c=s[2],h=Math.sqrt(a*a+o*o+c*c);return Math.abs(h)<L.EPSILON?null:(h=1/h,a*=h,o*=h,c*=h,i=Math.sin(e),r=Math.cos(e),n=1-r,t[0]=a*a*n+r,t[1]=o*a*n+c*i,t[2]=c*a*n-o*i,t[3]=0,t[4]=a*o*n-c*i,t[5]=o*o*n+r,t[6]=c*o*n+a*i,t[7]=0,t[8]=a*c*n+o*i,t[9]=o*c*n-a*i,t[10]=c*c*n+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}static invert(t,e){const s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],c=e[6],h=e[7],l=e[8],d=e[9],u=e[10],x=e[11],m=e[12],E=e[13],f=e[14],T=e[15],p=s*o-i*a,_=s*c-r*a,A=s*h-n*a,g=i*c-r*o,R=i*h-n*o,L=r*h-n*c,S=l*E-d*m,w=l*f-u*m,y=l*T-x*m,b=d*f-u*E,M=d*T-x*E,P=u*T-x*f;let D=p*P-_*M+A*b+g*y-R*w+L*S;return D?(D=1/D,t[0]=(o*P-c*M+h*b)*D,t[1]=(r*M-i*P-n*b)*D,t[2]=(E*L-f*R+T*g)*D,t[3]=(u*R-d*L-x*g)*D,t[4]=(c*y-a*P-h*w)*D,t[5]=(s*P-r*y+n*w)*D,t[6]=(f*A-m*L-T*_)*D,t[7]=(l*L-u*A+x*_)*D,t[8]=(a*M-o*y+h*S)*D,t[9]=(i*y-s*M-n*S)*D,t[10]=(m*R-E*A+T*p)*D,t[11]=(d*A-l*R-x*p)*D,t[12]=(o*w-a*b-c*S)*D,t[13]=(s*b-i*w+r*S)*D,t[14]=(E*_-m*g-f*p)*D,t[15]=(l*g-d*_+u*p)*D,t):null}}L.EPSILON=1e-6;class S{constructor(t,e,s){this.setDirectory(t),this.setFileList(e),this.setOptions(s)}setDirectory(t="./"){return this.rep=t,this}setFileList(t=[]){return this.noms=t.map(t=>t.trim()),this}setOptions(t={}){return this.extension=t.extension?`.${t.extension}`:"",this.mediaType=t.mediaType||"text",this.treatment=t.treatment||null,this.default=t.default||void 0,this}initForLoad(){"image"===this.mediaType&&(this.mediaType="img"),"img"===this.mediaType||"video"===this.mediaType||"audio"===this.mediaType?this.requeteMode="media":this.requeteMode="file","arrayBuffer"!==this.mediaType&&"blob"!==this.mediaType&&"formData"!==this.mediaType&&"json"!==this.mediaType&&"text"===this.mediaType&&(this.mediaType="text"),this.fichiers=new Object}async loadMedia(t){return new Promise((e,s)=>{const i=document.createElement(this.mediaType);"img"==this.mediaType?i.onload=()=>{e(i)}:i.onloadedmetadata=()=>{e(i)},i.onerror=()=>{s()},i.src=`${this.rep}/${t}${this.extension}`})}async loadFile(t){return fetch(`${this.rep}/${t}${this.extension}`).then(t=>t.ok?t[this.mediaType]():Promise.reject())}async load(t,e=""){return this.initForLoad(),"function"!=typeof t&&(t=t=>{}),new Promise(async(s,i)=>{if(0==this.noms.length)t(100,e),s();else{let i,r=this.noms.length;i="media"===this.requeteMode?this.loadMedia.bind(this):this.loadFile.bind(this);for(const e of this.noms)t(Math.floor((this.noms.length-r)/this.noms.length*100),e),await i(e).then(async t=>{"function"==typeof this.treatment?this.fichiers[e]=await this.treatment(t,e):this.fichiers[e]=t,--r}).catch(t=>{console.warn(`Impossible de charger le fichier '${this.rep}/${e}${this.extension}'\n${t}`)});t(100,e),s()}})}get(t){const e=this.fichiers[t];return e||this.fichiers[this.default]}getAll(){return this.fichiers}}class w{constructor(){null==w.instance&&(w.instance=this,this.pressStates=new Array,this.toggleStates=new Array,this.clear(),window.onkeydown=t=>{if(t.ctrlKey)switch(t.keyCode){case 83:case 68:t.preventDefault(),t.stopPropagation()}},window.addEventListener("keydown",t=>(this.pressStates[t.keyCode]=!0,this.toggleStates[t.keyCode]=!this.toggleStates[t.keyCode],!1)),window.addEventListener("keyup",t=>(this.pressStates[t.keyCode]=!1,!1)),window.addEventListener("blur",t=>{for(let t=0;t<256;++t)w.instance.pressStates[t]=!1}))}clear(){for(let t=0;t<256;++t)w.instance.pressStates[t]=!1,w.instance.toggleStates[t]=!1}isPressed(t){return w.instance.pressStates[t]}isToggled(t){return w.instance.toggleStates[t]}}w.instance=null,w.BACKSPACE=8,w.TAB=9,w.ENTER=13,w.SHIFT=16,w.CTRL=17,w.ALT=18,w.PAUSE=19,w.CAPS_LOCK=20,w.ESCAPE=27,w.SPACE=32,w.PAGE_UP=33,w.PAGE_DOWN=34,w.END=35,w.HOME=36,w.LEFT_ARROW=37,w.UP_ARROW=38,w.RIGHT_ARROW=39,w.DOWN_ARROW=40,w.INSERT=45,w.DELETE=46,w.KEY_0=48,w.KEY_1=49,w.KEY_2=50,w.KEY_3=51,w.KEY_4=52,w.KEY_5=53,w.KEY_6=54,w.KEY_7=55,w.KEY_8=56,w.KEY_9=57,w.KEY_A=65,w.KEY_B=66,w.KEY_C=67,w.KEY_D=68,w.KEY_E=69,w.KEY_F=70,w.KEY_G=71,w.KEY_H=72,w.KEY_I=73,w.KEY_J=74,w.KEY_K=75,w.KEY_L=76,w.KEY_M=77,w.KEY_N=78,w.KEY_O=79,w.KEY_P=80,w.KEY_Q=81,w.KEY_R=82,w.KEY_S=83,w.KEY_T=84,w.KEY_U=85,w.KEY_V=86,w.KEY_W=87,w.KEY_X=88,w.KEY_Y=89,w.KEY_Z=90,w.LEFT_META=91,w.RIGHT_META=92,w.SELECT=93,w.NUMPAD_0=96,w.NUMPAD_1=97,w.NUMPAD_2=98,w.NUMPAD_3=99,w.NUMPAD_4=100,w.NUMPAD_5=101,w.NUMPAD_6=102,w.NUMPAD_7=103,w.NUMPAD_8=104,w.NUMPAD_9=105,w.MULTIPLY=106,w.ADD=107,w.SUBTRACT=109,w.DECIMAL=110,w.DIVIDE=111,w.F1=112,w.F2=113,w.F3=114,w.F4=115,w.F5=116,w.F6=117,w.F7=118,w.F8=119,w.F9=120,w.F10=121,w.F11=122,w.F12=123,w.NUM_LOCK=144,w.SCROLL_LOCK=145,w.SEMICOLON=186,w.EQUALS=187,w.COMMA=188,w.DASH=189,w.PERIOD=190,w.FORWARD_SLASH=191,w.GRAVE_ACCENT=192,w.OPEN_BRACKET=219,w.BACK_SLASH=220,w.CLOSE_BRACKET=221,w.SINGLE_QUOTE=222;class y{constructor(){null==y.instance&&(y.instance=this,i.mouse=this.update,this.pressStates=new Array,this.toggleStates=new Array,this.x=0,this.y=0,this.update(),o.ctx?this.setDOMElementReference(o.ctx.canvas):this.setDOMElementReference({getBoundingClientRect:()=>({left:0,top:0})}),this.clear(),window.addEventListener("mousedown",t=>{t.preventDefault(),this.pressStates[t.button]=!0,this.toggleStates[t.button]=!this.toggleStates[t.button]}),window.addEventListener("mouseup",t=>{this.pressStates[t.button]=!1}),window.addEventListener("contextmenu",t=>(t.preventDefault(),!1)),window.addEventListener("mousemove",t=>{const e=y.domRef.getBoundingClientRect();y.instance.x=t.clientX-(e.left+window.scrollX),y.instance.y=t.clientY-(e.top+window.scrollY),y.instance.movX+=t.movementX,y.instance.movY+=t.movementY}),window.addEventListener("wheel",t=>(y.instance.mouseScrollVelX=t.deltaX>0?1:-1,y.instance.mouseScrollVelY=t.deltaY>0?1:-1,!1)))}clear(){for(let t=0;t<4;++t)y.instance.pressStates[t]=!1,y.instance.toggleStates[t]=!1}update(){y.instance.mouseScrollVelX=0,y.instance.mouseScrollVelY=0,y.instance.movX=0,y.instance.movY=0}isPressed(t){return y.instance.pressStates[t]}isToggled(t){return y.instance.toggleStates[t]}posX(){return y.instance.x}posY(){return y.instance.y}velX(){return y.instance.movX}velY(){return y.instance.movY}scrollVelX(){return y.instance.mouseScrollVelX}scrollVelY(){return y.instance.mouseScrollVelY}setDOMElementReference(t){y.domRef=t}}y.instance=null,y.LEFT_BUTTON=0,y.WHEEL_BUTTON=1,y.RIGHT_BUTTON=2;class b{constructor(){if(null==b.instance){b.instance=this,i.gamepad=this.update,this.states=new Array,this.connect=[!1,!1,!1,!1],this.setDeadZone(.1);for(let t=0;t<4;++t)this.clear(t);window.addEventListener("gamepadconnected",t=>{this.connect[t.gamepad.index]=!0}),window.addEventListener("gamepaddisconnected",t=>{this.clear(t.gamepad.index),this.connect[t.gamepad.index]=!1})}}clear(t=b.PLAYER1){const e=new Array;for(let t=0;t<17;++t)e.push({value:0});b.instance.states[t]={axes:[0,0,0,0],buttons:e}}update(){let t=0;for(let e of navigator.getGamepads())if(e){const s=b.instance.states[t++];s.buttons=e.buttons,s.axes[0]=e.axes[0]>=b.deadZone||e.axes[0]<=-b.deadZone?e.axes[0]:0,s.axes[1]=e.axes[1]>=b.deadZone||e.axes[1]<=-b.deadZone?e.axes[1]:0,s.axes[2]=e.axes[2]>=b.deadZone||e.axes[2]<=-b.deadZone?e.axes[2]:0,s.axes[3]=e.axes[3]>=b.deadZone||e.axes[3]<=-b.deadZone?e.axes[3]:0}}isConnect(t=b.PLAYER1){return b.instance.connect[t]}setDeadZone(t){b.deadZone=t}getButton(t,e=b.PLAYER1){return b.instance.states[e].buttons[t].value}getStickAX(t=b.PLAYER1){return b.instance.states[t].axes[0]}getStickAY(t=b.PLAYER1){return b.instance.states[t].axes[1]}getStickBX(t=b.PLAYER1){return b.instance.states[t].axes[2]}getStickBY(t=b.PLAYER1){return b.instance.states[t].axes[3]}}b.instance=null,b.PLAYER1=0,b.PLAYER2=2,b.PLAYER3=2,b.PLAYER4=3,b.A=0,b.B=1,b.X=2,b.Y=3,b.LEFT_BUTTON=4,b.RIGHT_BUTTON=5,b.LEFT_TRIGGER=6,b.RIGHT_TRIGGER=7,b.SELECT=8,b.START=9,b.LEFT_STICK=10,b.RIGHT_STICK=11,b.UP=12,b.DOWN=13,b.LEFT=14,b.RIGHT=15,b.GUIDE=16;class M{constructor(){null==M.instance&&(M.instance=this,o.ctx?this.setDOMElementReference(o.ctx.canvas):this.setDOMElementReference({getBoundingClientRect:()=>({left:0,top:0})}),this.clear(),window.addEventListener("touchstart",t=>{const e=M.domRef.getBoundingClientRect(),s=t.touches[0];M.instance.x=s.clientX-(e.left+window.scrollX),M.instance.y=s.clientY-(e.top+window.scrollY),M.instance.lastX=M.instance.x,M.instance.lastY=M.instance.y,M.isTouch=!0}),window.addEventListener("touchmove",t=>{const e=M.domRef.getBoundingClientRect(),s=t.touches[0];M.instance.x=s.clientX-(e.left+window.scrollX),M.instance.y=s.clientY-(e.top+window.scrollY),M.instance.movX=M.instance.x-M.instance.lastX,M.instance.movY=M.instance.y-M.instance.lastY,M.instance.lastX=M.instance.x,M.instance.lastY=M.instance.y}),window.addEventListener("touchend",t=>{M.instance.movX=0,M.instance.movY=0,M.isTouch=!1}))}clear(){M.instance.lastX=0,M.instance.lastY=0,M.instance.x=0,M.instance.y=0,M.instance.movX=0,M.instance.movY=0,M.isTouch=!1}isTouch(){return M.isTouch}touchX(){return M.instance.x}touchY(){return M.instance.y}swipX(){return M.instance.movX}swipY(){return M.instance.movY}scaleVel(){}setDOMElementReference(t){M.domRef=t}}M.instance=null;class P{constructor(t,e){this.position=new Float32Array([0,0,0]),this.up=new Float32Array([0,1,0]),this.forward=new Float32Array([0,0,1]),this.camera=L.identity(new Float32Array(16)),this.projection=L.perspective(L.identity(new Float32Array(16)),1.0472,t/e,.001,1),this.buffer=L.identity(new Float32Array(16))}getPosition(){return this.position}getUp(){return this.up}getForward(){return this.forward}update(){L.lookAt(this.camera,this.position,this.forward,this.up)}getProjectionMatrix(){return this.projection}getCameraMatrix(){return this.camera}getVPMatrix(){return L.multiply(this.buffer,this.projection,this.camera)}}P.DEMIPI=Math.PI/2;class D{constructor(){this.head=null,this.tail=null,this.count=0}isEmpty(){return 0===this.count}get lenght(){return this.count}addFirst(t){const e={data:t,next:null},s=this.head;this.head=e,this.head.next=s,++this.count,1===this.count&&(this.tail=this.head)}addLast(t){const e={data:t,next:null};0===this.count?this.head=e:this.tail.next=e,this.tail=e,++this.count}deleteFisrt(){0!==this.count&&(this.head=this.head.next,--this.count,0===this.count&&(this.tail=null))}deleteLast(){if(0!==this.count){if(1===this.count)this.tail=null,this.head=null;else{let t=this.head;for(;t.next!==this.tail;)t=t.next;t.next=null,this.tail=t}--this.count}}deleteFromIndex(t){if(t<=0)this.deleteFisrt();else if(t>=this.count-1)this.deleteLast();else{let e,s=this.head,i=0;for(;null!==s&&i<t;)++i,e=s,s=s.next;e.next=s.next,--this.count}}delete(t){let e,s=this.head;if(s.data==t)this.deleteFisrt();else{for(;null!==s&&t!=s.data;)e=s,s=s.next;e.next=s.next,--this.count}}[Symbol.iterator](){const t={value:null,done:!1};let e=this.head;return{next:()=>(e?(t.value=e.data,e=e.next):t.done=!0,t)}}}class N{constructor(){this.linkedLists=new Object,this.removeBuffers=new Object,this.names=new Array}getNames(){return this.names}createList(t){const e=new D;return this.addList(t,e),e}addList(t,e){e instanceof D&&(this.linkedLists[t]=e,this.removeBuffers[t]=new D,this.names.push(t))}getList(t){return this.linkedLists[t]}add(t,e){this.linkedLists[t].addLast(e)}delete(t,e){this.removeBuffers[t].addLast(e)}clear(){for(const t of this.names){const e=this.linkedLists[t],s=this.removeBuffers[t];for(const t of s)e.delete(t),s.deleteFisrt()}}[Symbol.iterator](){const t={value:null,done:!1},e=this.names;let s=0;const i=this.linkedLists;let r=this.linkedLists[e[s]];if(!r||!r.head)return{next:()=>({done:!0})};let n=r.head;return{next:()=>(n?(t.value=n.data,n=n.next):(r=i[e[++s]],r&&r.head?(n=r.head.next,t.value=r.head.data):t.done=!0),t)}}}class F{constructor(t,e,s=19,i=29){this.shader=new E(t,e,"Player"),this.shape=(new f).addVBO(new h([0,0,s,i,0,i,0,0,s,0,s,i],2,this.shader.getAttribLocation("vertex"))),this.matrix=L.identity()}prepare(t){this.shader.use(),this.shader.sendMat4("camera",t)}render(t){const e=t.getSprite(),s=e.prepare();this.matrix[12]=t.x,this.matrix[13]=t.y,this.shader.sendFloat("spriteOffset",s),this.shader.sendFloat("nbFrame",e.getNbFrame()),this.shader.sendMat4("position",this.matrix),this.shape.draw()}}class I{constructor(t,e,s){this.x=t,this.y=e,this.sprites=s,this.currentSprite=1,this.speed=45,this.keyboard=new w,this.gesture=new M,this.hitBox={x0:-7,y0:7.25,x1:7,y1:0}}getHitBox(){return{x0:this.hitBox.x0+this.x,y0:this.hitBox.y0+this.y,x1:this.hitBox.x1+this.x,y1:this.hitBox.y1+this.y}}getSprite(){return this.sprites[this.currentSprite]}update(){const t=this.speed*i.delta;let e=!1;(this.keyboard.isPressed(w.KEY_Q)||this.gesture.isTouch()&&this.gesture.touchX()<175)&&(this.x-=t,this.currentSprite=2,e=!0),(this.keyboard.isPressed(w.KEY_D)||this.gesture.isTouch()&&this.gesture.touchX()>525)&&(this.x+=t,this.currentSprite=3,e=!0),(this.keyboard.isPressed(w.KEY_Z)||this.gesture.isTouch()&&this.gesture.touchY()<175)&&(this.y+=t,this.currentSprite=0,e=!0),(this.keyboard.isPressed(w.KEY_S)||this.gesture.isTouch()&&this.gesture.touchY()>525)&&(this.y-=t,this.currentSprite=1,e=!0),e?this.getSprite().next():this.getSprite().reset()}}class O{constructor(t,e=1){this.texture=t,this.clock=new a(0,e,5),this.offSet=this.texture.getWidth()/e,this.nbframe=e}getNbFrame(){return this.nbframe}next(){this.clock.next()}reset(){this.clock.reset()}prepare(){return this.texture.use(),this.clock.getValue()*this.offSet}}class C{constructor(t,e){this.display=t,this.frameBuffer=new m(this.display.getWidth(),this.display.getHeight()),this.roomShader=new E(e.get("room.vs"),e.get("room.fs")),this.mainShader=new E(e.get("main.vs"),e.get("main.fs")),this.mainShader.use(),this.mainShader.sendFloat("screenHeight",this.display.getHeight()),this.hitShader=new E(e.get("hit.vs"),e.get("hit.fs")),this.screen=(new f).addVBO(new h([-1,-1,1,1,-1,1,-1,-1,1,-1,1,1],2,0)),this.rectPoints=new h([0,0,0,0,0,0,0,0],2,0).setUsage(h.DYNAMIC_DRAW),this.rect=(new f).setMode(f.LINE_LOOP).addVBO(this.rectPoints),this.roomPoints=new h([0,0,0,0,0,0,0,0],2,0).setUsage(h.DYNAMIC_DRAW),this.room=(new f).setMode(f.TRIANGLE_FAN).addVBO(this.roomPoints).addVBO(new h([0,0,1,0,1,1,0,1],2,1)),this.playerRenderer=new F(e.get("player.vs"),e.get("player.fs")),this.cam=L.identity(),this.cam[0]=.006,this.cam[5]=.006}render(t){let e=t.player.x,s=t.player.y;e=Math.min(Math.max(e,t.currentRoom.camMinX),t.currentRoom.camMaxX),s=Math.min(Math.max(s,t.currentRoom.camMinY),t.currentRoom.camMaxY),this.cam[12]=.006*-e,this.cam[13]=.006*-s,this.frameBuffer.use(),this.display.clear();{const e=t.currentRoom.bounds;this.roomShader.use(),this.roomShader.sendMat4("camera",this.cam),this.roomPoints.setData(new Float32Array([e.x0,e.y0,e.x1,e.y0,e.x1,e.y1,e.x0,e.y1])),t.currentRoom.texture.use(),this.room.draw()}this.playerRenderer.prepare(this.cam),this.playerRenderer.render(t.player),this.display.useDefaultFrameBuffer(),this.display.clear(),this.mainShader.use(),this.mainShader.sendFloat("iTime",i.now),this.frameBuffer.getColorTexture().use(),this.screen.draw()}}const v=new i,U=new o(700,700);U.setClearColor(0,0,0,1);const B=new _(!1);B.setVolume(.45);const Y=new class{constructor(){this.currentObjects=new N,this.player,this.field=new g,this.currentRoom=null,this.hitBuffer=new Set,this.roomsBuffer=new Set}update(){this.player.update(),this.hitBuffer.clear();const t=67;this.field.query(this.player.x/t,(this.player.y+10)/t,this.hitBuffer),this.field.query(this.player.x/t,this.player.y/t,this.hitBuffer),this.field.query((this.player.x-10)/t,this.player.y/t,this.hitBuffer),this.field.query((this.player.x+10)/t,this.player.y/t,this.hitBuffer);const e=this.player.getHitBox();for(let t of this.hitBuffer)if(!(e.x0>t.x1||e.x1<t.x0||e.y0<t.y1||e.y1>t.y0)){const s=t.x1-e.x0,i=e.x1-t.x0,r=e.y0-t.y1,n=t.y0-e.y1,a=Math.min(Math.abs(s),Math.abs(i)),o=Math.min(Math.abs(r),Math.abs(n));Math.min(a,o)==a?a==Math.abs(s)&&s>0?this.player.x+=Math.abs(s):a==Math.abs(i)&&i>0&&(this.player.x-=Math.abs(i)):o==Math.abs(r)&&r>0?this.player.y-=Math.abs(r):o==Math.abs(n)&&n>0&&(this.player.y+=Math.abs(n))}this.roomsBuffer.clear(),this.roomsField.query(this.player.x/t,this.player.y/t,this.roomsBuffer);for(let t of this.roomsBuffer)this.player.x>t.x1||this.player.x<t.x0||this.player.y<t.y1||this.player.y>t.y0||(this.currentRoom=this.roomDatas[t.id],this.currentRoom.bounds=t)}};let k;v.onInit(async()=>{const t={};t.textures=new S("./textures",["frisk_face","frisk_back","frisk_left","frisk_right","house_coridor","house_hall","house_kitchen","house_living_room"],{extension:"png",mediaType:"image",treatment:(t,e)=>new u(t).setParameters({wrapT:u.CLAMP_TO_EDGE,wrapS:u.CLAMP_TO_EDGE,magFilter:u.NEAREST,minFilter:u.NEAREST})}),await t.textures.load(t=>{console.log(`Chargement : ${t}%`)}),t.sons=new S("./sons",["undertale"],{extension:"mp3",mediaType:"arrayBuffer",treatment:t=>(new A).loadData(t)}),await t.sons.load(t=>{console.log(`Chargement : ${t}%`)}),t.map=new S("./map",["main","rooms"],{extension:"hitmap",mediaType:"text",treatment:t=>{const e=new g,s=new Array,i=t.split("\n");let r=0;for(let t of i){const e=t.split(" ");if(4==e.length){const t=parseFloat(e[0]),i=parseFloat(e[1]),n=parseFloat(e[2]),a=parseFloat(e[3]);s.push({x0:t,y0:i,x1:n,y1:a,id:r++})}}for(let t of s){const s=67;R.addToField(t.x0/s,t.y0/s,t.x1/s,t.y0/s,e,t),R.addToField(t.x1/s,t.y0/s,t.x1/s,t.y1/s,e,t),R.addToField(t.x1/s,t.y1/s,t.x0/s,t.y1/s,e,t),R.addToField(t.x0/s,t.y1/s,t.x0/s,t.y0/s,e,t)}return e}}),await t.map.load(t=>{console.log(`Chargement : ${t}%`)}),Y.field=t.map.get("main"),Y.roomsField=t.map.get("rooms"),t.shaders=new S("./shaders",["main.vs","main.fs","player.vs","player.fs","hit.vs","hit.fs","room.vs","room.fs"]),await t.shaders.load(t=>{console.log(`Chargement : ${t}%`)}),Y.player=new I(474,60,[new O(t.textures.get("frisk_back"),4),new O(t.textures.get("frisk_face"),4),new O(t.textures.get("frisk_left"),2),new O(t.textures.get("frisk_right"),2)]),Y.roomDatas=[{camMaxX:105,camMinX:105,camMaxY:295,camMinY:295,texture:t.textures.get("house_kitchen")},{camMaxX:165,camMinX:165,camMaxY:100,camMinY:100,texture:t.textures.get("house_living_room")},{camMaxX:478,camMinX:478,camMaxY:100,camMinY:100,texture:t.textures.get("house_hall")},{camMaxX:1260,camMinX:760,camMaxY:80,camMinY:80,texture:t.textures.get("house_coridor")}];for(let t of Y.roomsField.query(476/67,1/67))Y.currentRoom=Y.roomDatas[t.id],Y.currentRoom.bounds=t;t.sons.get("undertale").play(0,!0),k=new C(U,t.shaders),U.disable(o.CULL_FACE),U.disable(o.DEPTH_TEST)}),v.onTick(()=>{Y.update()}),B.askPermission().then(()=>{v.onDraw(()=>{k.render(Y)}),v.play()}),v.start()}]);