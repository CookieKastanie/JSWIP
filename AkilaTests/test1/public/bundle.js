!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor(t=300,e=300){if(s.ctx)throw"Display est un singleton. Kgl ne gère qu'un seul canevas à la fois.";if(this.canvas=document.createElement("canvas"),this.canvas.id="kgl-canvas",this.conteneur=document.getElementById("kgl-screen"),!this.conteneur)throw'Impossible de créer le canevas, il faut ajouter une balise avec l\'id "kgl-screen"';if(this.conteneur.appendChild(this.canvas),this.ctx=this.canvas.getContext("webgl"),this.ctx||(this.ctx=this.canvas.getContext("experimental-webgl")),!this.ctx)throw"Impossible de d'initialiser le contexte WebGL";this.use(),this.setSize(t,e),this.ctx.enable(this.ctx.DEPTH_TEST),this.setClearColor(Math.random(),Math.random(),Math.random(),1),this.ctx.enable(this.ctx.BLEND),this.ctx.enable(this.ctx.SAMPLE_ALPHA_TO_COVERAGE),this.ctx.blendFunc(this.ctx.SRC_ALPHA,this.ctx.ONE_MINUS_SRC_ALPHA),this.ctx.enable(this.ctx.CULL_FACE),this.ctx.frontFace(this.ctx.CCW),this.ctx.cullFace(this.ctx.BACK),this.clear()}getDiv(){return this.conteneur}setSize(t,e){this.canvas.width=t,this.canvas.height=e,this.ctx.viewport(0,0,t,e)}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}setClearColor(t,e,i,s){this.ctx.clearColor(t,e,i,s)}clear(){this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT)}getCtx(){return this.ctx}use(){s.ctx=this.getCtx()}useDefaultFrameBuffer(){this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),this.ctx.bindRenderbuffer(this.ctx.RENDERBUFFER,null),this.ctx.viewport(0,0,this.getWidth(),this.getHeight())}enable(t){this.ctx.enable(this.ctx[t])}disable(t){this.ctx.disable(this.ctx[t])}getCanvas(){return this.canvas}}s.ctx=null,s.BLEND="BLEND",s.CULL_FACE="CULL_FACE",s.DEPTH_TEST="DEPTH_TEST",s.DITHER="DITHER",s.POLYGON_OFFSET_FILL="POLYGON_OFFSET_FILL",s.SAMPLE_ALPHA_TO_COVERAGE="SAMPLE_ALPHA_TO_COVERAGE",s.SAMPLE_COVERAGE="SAMPLE_COVERAGE",s.SCISSOR_TEST="SCISSOR_TEST",s.STENCIL_TEST="STENCIL_TEST";class a{constructor(t){this.pointer=s.ctx.createBuffer(),this.dataLength=-1,this.setUsage(t)}setUsage(t=a.STATIC_DRAW){this.usage=s.ctx[t]}delete(){s.ctx.deleteBuffer(this.pointer)}}class r extends a{constructor(t,e,i,s){super(s),this.attribLocation=i,this.nbOfElement=e,this.setData=r.prototype.setNewData,t&&(void 0!==t.BYTES_PER_ELEMENT?this.setData(t):this.setData(new Float32Array(t)))}setData(){}setNewData(t){s.ctx.bindBuffer(s.ctx.ARRAY_BUFFER,this.pointer),s.ctx.bufferData(s.ctx.ARRAY_BUFFER,t,this.usage),this.dataLength=t.length,this.setData=r.prototype.setSubData}setSubData(t,e=0){s.ctx.bindBuffer(s.ctx.ARRAY_BUFFER,this.pointer),s.ctx.bufferSubData(s.ctx.ARRAY_BUFFER,e,t)}getDataLength(){return this.dataLength/(this.nbOfElement/Float32Array.BYTES_PER_ELEMENT)}use(){s.ctx.bindBuffer(s.ctx.ARRAY_BUFFER,this.pointer),s.ctx.vertexAttribPointer(this.attribLocation,this.nbOfElement,s.ctx.FLOAT,s.ctx.FALSE,0,0)}}class n extends a{constructor(t,e){super(e),this.setData=n.prototype.setNewData,t&&(void 0!==t.BYTES_PER_ELEMENT?this.setData(t):this.setData(new Uint16Array(t)))}setData(){}setNewData(t){s.ctx.bindBuffer(s.ctx.ELEMENT_ARRAY_BUFFER,this.pointer),s.ctx.bufferData(s.ctx.ELEMENT_ARRAY_BUFFER,t,this.usage),this.dataLength=t.length,this.setData=n.prototype.setSubData}setSubData(t,e=0){s.ctx.bindBuffer(s.ctx.ELEMENT_ARRAY_BUFFER,this.pointer),s.ctx.bufferSubData(s.ctx.ELEMENT_ARRAY_BUFFER,e,t)}getDataLength(){return this.dataLength}use(){s.ctx.bindBuffer(s.ctx.ELEMENT_ARRAY_BUFFER,this.pointer)}}n.STATIC_DRAW=r.STATIC_DRAW=a.STATIC_DRAW="STATIC_DRAW",n.DYNAMIC_DRAW=r.DYNAMIC_DRAW=a.DYNAMIC_DRAW="DYNAMIC_DRAW",n.STREAM_DRAW=r.STREAM_DRAW=a.STREAM_DRAW="STREAM_DRAW";class h{constructor(t,e,i="Shader"){if(this.name=i,this.program=null,this.attributList=new Object,this.attributNumber=0,this.uniformList=new Object,this.vertexShader=this.createShader(s.ctx.VERTEX_SHADER,t),!this.vertexShader)return;if(this.fragmantShader=this.createShader(s.ctx.FRAGMENT_SHADER,e),!this.fragmantShader)return;this.createProgramme();let a=null,r=0;const n=s.ctx.getProgramParameter(this.program,s.ctx.ACTIVE_UNIFORMS);for(;r<n;)(a=s.ctx.getActiveUniform(this.program,r++))&&this.initUniformLocation(a.name)}delShad(t){s.ctx.detacheShader(this.program,t),s.ctx.deleteShader(t)}createShader(t,e){const i=s.ctx.createShader(t);return s.ctx.shaderSource(i,e),s.ctx.compileShader(i),s.ctx.getShaderParameter(i,s.ctx.COMPILE_STATUS)?i:(console.error(this.name+" -> erreur de compilation "+(t==s.ctx.VERTEX_SHADER?"vertex":"fragment")+" shader!",s.ctx.getShaderInfoLog(i)),null)}createProgramme(){let t=s.ctx.createProgram();s.ctx.attachShader(t,this.vertexShader),s.ctx.attachShader(t,this.fragmantShader),s.ctx.linkProgram(t),s.ctx.getProgramParameter(t,s.ctx.LINK_STATUS)?(s.ctx.validateProgram(t),s.ctx.getProgramParameter(t,s.ctx.VALIDATE_STATUS)?this.program=t:console.error(this.name+" -> erreur de validation du programme",s.ctx.getProgramInfoLog(t))):console.error(this.name+" -> Impossible de lier le programme",s.ctx.getProgramInfoLog(t))}initUniformLocation(t){const e=s.ctx.getUniformLocation(this.program,t);e?this.uniformList[t]=e:console.error("Uniform '"+t+"' n'existe pas dans "+this.name)}delete(){this.program&&(this.delShad(this.vertexShader),this.delShad(this.fragmantShader),s.ctx.deleteProgram(this.program),this.program=null)}use(){if(!this.program)return console.error(this.name+" -> Programme invalide");s.ctx.useProgram(this.program);for(let t=0;t<=h.attributeMax;++t)t<=this.attributNumber?s.ctx.enableVertexAttribArray(t):s.ctx.disableVertexAttribArray(t)}getAttribLocation(t){if(void 0===this.attributList[t]){const e=s.ctx.getAttribLocation(this.program,t);if(e<0)return void console.error("L'attribut '"+t+"' n'existe pas, ou il n'est pas utilisé dans "+this.name);this.attributNumber<e&&(this.attributNumber=e),h.attributeMax<e&&(h.attributeMax=e),this.attributList[t]=e}return this.attributList[t]}getUniformLocation(t){return this.uniformList[t]}sendFloat(t,e){s.ctx.uniform1f(this.getUniformLocation(t),e)}sendInt(t,e){s.ctx.uniform1i(this.getUniformLocation(t),e)}sendVec2(t,e){s.ctx.uniform2fv(this.getUniformLocation(t),e)}sendVec3(t,e){s.ctx.uniform3fv(this.getUniformLocation(t),e)}sendVec4(t,e){s.ctx.uniform4fv(this.getUniformLocation(t),e)}sendMat4(t,e){s.ctx.uniformMatrix4fv(this.getUniformLocation(t),s.ctx.FALSE,e)}}h.attributeMax=0;class o{constructor(t,e=null,i=0){let a,r,n,h=!1;null!=e&&"number"==typeof t?(a={width:t,height:e},h=!0,n=i):(a=t,r=t,n=null==e?0:e),this.id=o.idMax++,this.width=a.width,this.height=a.height,this.texture=s.ctx.createTexture(),this.setUnit(n),this.use(),h?s.ctx.texImage2D(s.ctx.TEXTURE_2D,0,s.ctx.RGBA,this.width,this.height,0,s.ctx.RGBA,s.ctx.UNSIGNED_BYTE,null):this.setTextureData(r),this.isPowerOf2(a.width)&&this.isPowerOf2(a.height)?(s.ctx.generateMipmap(s.ctx.TEXTURE_2D),s.ctx.texParameterf(s.ctx.TEXTURE_2D,s.ctx.TEXTURE_MAG_FILTER,s.ctx.LINEAR),s.ctx.texParameterf(s.ctx.TEXTURE_2D,s.ctx.TEXTURE_MIN_FILTER,s.ctx.LINEAR_MIPMAP_LINEAR)):(s.ctx.texParameteri(s.ctx.TEXTURE_2D,s.ctx.TEXTURE_WRAP_S,s.ctx.CLAMP_TO_EDGE),s.ctx.texParameteri(s.ctx.TEXTURE_2D,s.ctx.TEXTURE_WRAP_T,s.ctx.CLAMP_TO_EDGE),s.ctx.texParameteri(s.ctx.TEXTURE_2D,s.ctx.TEXTURE_MIN_FILTER,s.ctx.LINEAR))}setTextureData(t){this.use(),s.ctx.texImage2D(s.ctx.TEXTURE_2D,0,s.ctx.RGBA,s.ctx.RGBA,s.ctx.UNSIGNED_BYTE,t)}getLocation(){return this.texture}isPowerOf2(t){return 0==(t&t-1)}setUnit(t){return this.unit=t,this}getUnit(){return this.unit}use(){o.currentIds[this.unit]!=this.id&&(o.currentIds[this.unit]=this.id,s.ctx.activeTexture(s.ctx.TEXTURE0+this.unit),s.ctx.bindTexture(s.ctx.TEXTURE_2D,this.texture))}}o.idMax=0,o.currentIds=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];class c{constructor(t){this.id=c.idMax++,this.draw=c.prototype.drawVAO,this.setMode(t),this.vbos=new Array,this.vboNames=new Object}setMode(t=c.TRIANGLES){return this.mode=s.ctx[t],this}addVBO(t,e=this.vbos.length){const i=this.vbos.length;return this.vboNames[e]=i,this.vbos.push(t),this.refreshDataLength(),this}getVBO(t){return this.vbos[this.vboNames[t]]}use(){this.id!=c.currentId&&(this.useVBOs(),c.currentId=this.id)}refreshDataLength(){for(const t of this.vbos)if(this.dataLength=t.getDataLength(),this.dataLength<0)break}useVBOs(){for(const t of this.vbos)t.use()}drawCheck(){this.refreshDataLength(),this.dataLength>=0&&(this.draw=c.prototype.drawVAO,this.draw())}drawVAO(){this.useVBOs(),s.ctx.drawArrays(this.mode,0,this.dataLength)}delete(){for(const t of this.vbos)t.delete()}}c.idMax=0,c.currentId=-1;class d extends c{constructor(t,e){super(t),this.draw=d.prototype.drawCheck,e&&this.setIBO(e)}setIBO(t){return this.ibo=t,this}getIBO(){return this.ibo}refreshDataLength(){this.nbIndex=this.ibo.getDataLength()}useVBOs(){this.ibo.use(),super.useVBOs()}draw(){}drawCheck(){this.refreshDataLength(),this.nbIndex>=0&&(this.draw=d.prototype.drawVAO,this.draw())}drawVAO(){this.use(),s.ctx.drawElements(this.mode,this.nbIndex,s.ctx.UNSIGNED_SHORT,0)}delete(){this.ibo&&this.ibo.delete(),super.delete()}}d.TRIANGLES=c.TRIANGLES="TRIANGLES",d.TRIANGLE_STRIP=c.TRIANGLE_STRIP="TRIANGLE_STRIP",d.TRIANGLE_FAN=c.TRIANGLE_FAN="TRIANGLE_FAN",d.POINTS=c.POINTS="POINTS",d.LINES=c.LINES="LINES",d.LINE_STRIP=c.LINE_STRIP="LINE_STRIP",d.LINE_LOOP=c.LINE_LOOP="LINE_LOOP",d.STATIC_DRAW=c.STATIC_DRAW="STATIC_DRAW",d.DYNAMIC_DRAW=c.DYNAMIC_DRAW="DYNAMIC_DRAW",d.STREAM_DRAW=c.STREAM_DRAW="STREAM_DRAW";class u{static identity(t=new Float32Array(16)){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static lookAt(t,e,i,s){let a,r,n,h,o,c,d,l,x,m,E=e[0],f=e[1],p=e[2],A=s[0],g=s[1],T=s[2],L=i[0],b=i[1],R=i[2];return Math.abs(E-L)<u.EPSILON&&Math.abs(f-b)<u.EPSILON&&Math.abs(p-R)<u.EPSILON?u.identity(t):(d=E-L,l=f-b,x=p-R,a=g*(x*=m=1/Math.sqrt(d*d+l*l+x*x))-T*(l*=m),r=T*(d*=m)-A*x,n=A*l-g*d,(m=Math.sqrt(a*a+r*r+n*n))?(a*=m=1/m,r*=m,n*=m):(a=0,r=0,n=0),h=l*n-x*r,o=x*a-d*n,c=d*r-l*a,(m=Math.sqrt(h*h+o*o+c*c))?(h*=m=1/m,o*=m,c*=m):(h=0,o=0,c=0),t[0]=a,t[1]=h,t[2]=d,t[3]=0,t[4]=r,t[5]=o,t[6]=l,t[7]=0,t[8]=n,t[9]=c,t[10]=x,t[11]=0,t[12]=-(a*E+r*f+n*p),t[13]=-(h*E+o*f+c*p),t[14]=-(d*E+l*f+x*p),t[15]=1,t)}static perspective(t,e,i,s,a){let r=1/Math.tan(e/2),n=1/(s-a);return t[0]=r/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+s)*n,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*s*n,t[15]=1,t}static ortho(t,e,i,s,a,r,n){let h=1/(e-i),o=1/(s-a),c=1/(r-n);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*h,t[13]=(a+s)*o,t[14]=(n+r)*c,t[15]=1,t}static mult(t,e,i){let s=e[0],a=e[1],r=e[2],n=e[3],h=e[4],o=e[5],c=e[6],d=e[7],u=e[8],l=e[9],x=e[10],m=e[11],E=e[12],f=e[13],p=e[14],A=e[15],g=i[0],T=i[1],L=i[2],b=i[3];return t[0]=g*s+T*h+L*u+b*E,t[1]=g*a+T*o+L*l+b*f,t[2]=g*r+T*c+L*x+b*p,t[3]=g*n+T*d+L*m+b*A,g=i[4],T=i[5],L=i[6],b=i[7],t[4]=g*s+T*h+L*u+b*E,t[5]=g*a+T*o+L*l+b*f,t[6]=g*r+T*c+L*x+b*p,t[7]=g*n+T*d+L*m+b*A,g=i[8],T=i[9],L=i[10],b=i[11],t[8]=g*s+T*h+L*u+b*E,t[9]=g*a+T*o+L*l+b*f,t[10]=g*r+T*c+L*x+b*p,t[11]=g*n+T*d+L*m+b*A,g=i[12],T=i[13],L=i[14],b=i[15],t[12]=g*s+T*h+L*u+b*E,t[13]=g*a+T*o+L*l+b*f,t[14]=g*r+T*c+L*x+b*p,t[15]=g*n+T*d+L*m+b*A,t}static fromRotation(t,e,i){let s,a,r,n=i[0],h=i[1],o=i[2],c=Math.sqrt(n*n+h*h+o*o);return Math.abs(c)<u.EPSILON?null:(n*=c=1/c,h*=c,o*=c,s=Math.sin(e),r=1-(a=Math.cos(e)),t[0]=n*n*r+a,t[1]=h*n*r+o*s,t[2]=o*n*r-h*s,t[3]=0,t[4]=n*h*r-o*s,t[5]=h*h*r+a,t[6]=o*h*r+n*s,t[7]=0,t[8]=n*o*r+h*s,t[9]=h*o*r-n*s,t[10]=o*o*r+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}}u.EPSILON=1e-6;class l{static obj(t){const e=t.split("\n").map(t=>t.split(/(\s+)/).filter(t=>t.trim().length>0)),i=new Array,s=new Array,a=new Array,r=new Array,n=new Array;for(let t of e)switch(t[0]){case"v":i.push({x:parseFloat(t[1]),y:parseFloat(t[2]),z:parseFloat(t[3])});break;case"vn":s.push({x:parseFloat(t[1]),y:parseFloat(t[2]),z:parseFloat(t[3])});break;case"vt":a.push({u:parseFloat(t[1]),v:parseFloat(t[2])});break;case"f":const e=t[1].split("/"),h=t[2].split("/"),o=t[3].split("/");r.push({vert1:parseInt(e[0])-1,vert2:parseInt(h[0])-1,vert3:parseInt(o[0])-1,tex1:parseInt(e[1])-1,tex2:parseInt(h[1])-1,tex3:parseInt(o[1])-1,norm1:parseInt(e[2])-1,norm2:parseInt(h[2])-1,norm3:parseInt(o[2])-1}),n.push(parseInt(e[0])-1),n.push(parseInt(h[0])-1),n.push(parseInt(o[0])-1)}const h=new Array,o=new Array,c=new Array;for(const t of r){const e=3*t.vert1,r=2*t.vert1,n=3*t.vert2,d=2*t.vert2,u=3*t.vert3,l=2*t.vert3;h[e]=i[t.vert1].x,h[e+1]=i[t.vert1].y,h[e+2]=i[t.vert1].z,h[n]=i[t.vert2].x,h[n+1]=i[t.vert2].y,h[n+2]=i[t.vert2].z,h[u]=i[t.vert3].x,h[u+1]=i[t.vert3].y,h[u+2]=i[t.vert3].z,a.length>0&&(c[r]=a[t.tex1].u,c[r+1]=a[t.tex1].v,c[d]=a[t.tex2].u,c[d+1]=a[t.tex2].v,c[l]=a[t.tex3].u,c[l+1]=a[t.tex3].v),s.length>0&&(o[e]=s[t.norm1].x,o[e+1]=s[t.norm1].y,o[e+2]=s[t.norm1].z,o[n]=s[t.norm2].x,o[n+1]=s[t.norm2].y,o[n+2]=s[t.norm2].z,o[u]=s[t.norm3].x,o[u+1]=s[t.norm3].y,o[u+2]=s[t.norm3].z)}return{positions:new Float32Array(h),normals:new Float32Array(o),texcoords:new Float32Array(c),indices:new Uint16Array(n)}}}class x{constructor(t,e,i){this.setDirectory(t),this.setFileListe(e),this.setOptions(i)}setDirectory(t="./"){return this.rep=t,this}setFileListe(t=[]){return this.noms=t.map(t=>t.trim()),this}setOptions(t={}){return this.extension=t.extension?`.${t.extension}`:"",this.mediaType=t.mediaType||"text",this.treatment=t.treatment||null,this.default=t.default||void 0,this}initForLoad(){"image"===this.mediaType&&(this.mediaType="img"),"img"===this.mediaType||"video"===this.mediaType||"audio"===this.mediaType?this.requeteMode="media":this.requeteMode="file","arrayBuffer"!==this.mediaType&&"blob"!==this.mediaType&&"formData"!==this.mediaType&&"json"!==this.mediaType&&"text"===this.mediaType&&(this.mediaType="text"),this.fichiers=new Object}async loadMedia(t){return new Promise((e,i)=>{const s=document.createElement(this.mediaType);"img"==this.mediaType?s.onload=(()=>{e(s)}):s.onloadedmetadata=(()=>{e(s)}),s.onerror=(()=>{i()}),s.src=`${this.rep}/${t}${this.extension}`})}async loadFile(t){return fetch(`${this.rep}/${t}${this.extension}`).then(t=>t.ok?t[this.mediaType]():Promise.reject())}async load(t){return this.initForLoad(),"function"!=typeof t&&(t=(t=>{})),new Promise(async(e,i)=>{if(0==this.noms.length)t(100),e();else{let i,s=this.noms.length;t(0),i="media"===this.requeteMode?this.loadMedia.bind(this):this.loadFile.bind(this);for(const e of this.noms)await i(e).then(async i=>{"function"==typeof this.treatment?this.fichiers[e]=await this.treatment(i):this.fichiers[e]=i,--s,t(Math.floor((this.noms.length-s)/this.noms.length*100))}).catch(t=>{console.warn(`Impossible de charger le fichier '${this.rep}/${e}${this.extension}'\n${t}`)});e()}})}get(t){const e=this.fichiers[t];return e||this.fichiers[this.default]}getAll(){return this.fichiers}}class m{constructor(t,e){this.camMatrix=u.identity(new Float32Array(16)),this.projMatrix=u.perspective(u.identity(new Float32Array(16)),1.0472,t/e,.001,1),this.finalMat=u.identity(new Float32Array(16))}getMatrix(){return u.mult(this.finalMat,this.projMatrix,this.camMatrix)}}m.DEMIPI=Math.PI/2;class E extends m{constructor(t,e){super(t,e),this.sensibilite=.004,this.acc=.04,this.maxSpeed=.4,this.x=0,this.y=0,this.z=0,this.aX=0,this.aY=0,this.aZ=0,this.dfront=0,this.dlat=0,this.dhaut=0,this.front=0,this.lat=0,this.haut=0,this.temp=u.identity(new Float32Array(16)),this.temp2=u.identity(new Float32Array(16)),this.temp3=u.identity(new Float32Array(16)),this.xAxis=[1,0,0],this.yAxis=[0,1,0],this.zAxis=[0,0,1],this.movX=0,this.movY=0,this.canvas=document.getElementById("kgl-canvas"),this.canvas.addEventListener("click",()=>{document.pointerLockElement||this.canvas.requestPointerLock()}),this.canvas.addEventListener("mousemove",t=>{document.pointerLockElement&&(this.movX=-t.movementX*this.sensibilite,this.movY=-t.movementY*this.sensibilite)},!1),document.addEventListener("keydown",t=>{if(document.pointerLockElement)switch(t.ctrlKey&&t.preventDefault(),t.keyCode){case 90:this.dfront=1;break;case 81:this.dlat=1;break;case 83:this.dfront=-1;break;case 68:this.dlat=-1;break;case 32:this.dhaut=-1;break;case 17:this.dhaut=1}}),document.addEventListener("keyup",t=>{if(document.pointerLockElement)switch(t.keyCode){case 90:this.dfront=0;break;case 81:this.dlat=0;break;case 83:this.dfront=0;break;case 68:this.dlat=0;break;case 32:case 17:this.dhaut=0}})}setSpeed(t){return this.maxSpeed=t,this}setAcc(t){return this.acc=t,this}getMatrix(){0!=this.dfront?this.front+=this.acc*this.dfront:this.front>0?this.front-=this.acc:this.front<0&&(this.front+=this.acc),this.front<this.acc&&this.front>-this.acc&&(this.front=0),this.front>this.maxSpeed?this.front=this.maxSpeed:this.front<-this.maxSpeed&&(this.front=-this.maxSpeed),0!=this.dlat?this.lat+=this.acc*this.dlat:this.lat>0?this.lat-=this.acc:this.lat<0&&(this.lat+=this.acc),this.lat<this.acc&&this.lat>-this.acc&&(this.lat=0),this.lat>this.maxSpeed?this.lat=this.maxSpeed:this.lat<-this.maxSpeed&&(this.lat=-this.maxSpeed),0!=this.dhaut?this.haut+=this.acc*this.dhaut:this.haut>0?this.haut-=this.acc:this.haut<0&&(this.haut+=this.acc),this.haut<this.acc&&this.haut>-this.acc&&(this.haut=0),this.haut>this.maxSpeed?this.haut=this.maxSpeed:this.haut<-this.maxSpeed&&(this.haut=-this.maxSpeed);let t=Math.atan2(this.movX,this.movY),e=Math.sqrt(Math.pow(this.movX,2)+Math.pow(this.movY,2));return this.aX-=Math.cos(t)*e,this.aY-=Math.sin(t)*e,this.x+=Math.sin(-this.aY)*this.front+Math.cos(this.aY)*this.lat,this.y+=this.haut,this.z+=Math.cos(-this.aY)*this.front+Math.sin(this.aY)*this.lat,this.aX>m.DEMIPI?this.aX=m.DEMIPI:this.aX<-m.DEMIPI&&(this.aX=-m.DEMIPI),u.identity(this.temp),u.mult(this.temp,u.fromRotation(u.identity(this.temp2),this.aX,this.xAxis),u.fromRotation(u.identity(this.temp3),this.aY,this.yAxis)),u.identity(this.camMatrix),this.camMatrix[12]=this.x,this.camMatrix[13]=this.y,this.camMatrix[14]=this.z-1,u.mult(this.camMatrix,this.temp,this.camMatrix),this.camMatrix[14]+=1,this.movX=0,this.movY=0,super.getMatrix()}}const f=window.innerWidth,p=window.innerHeight;let A,g,T,L,b,R,S,_,I,M;(async()=>{const t=new x("./test",["BLF1","blue"],{extension:"jpg",mediaType:"image",default:"BLF1"});await t.load(t=>{console.log(`Chargement : ${t}%`)});const e=new x("./meshs",["cube","dragon","blue_falcon"],{extension:"obj",default:"cube",treatment:l.obj});await e.load(t=>{console.log(`Chargement : ${t}%`)});const i=new x("./shaders",["main.vs","main.fs","main2.vs","main2.fs"]);await i.load(t=>{console.log(`Chargement : ${t}%`)}),(A=new s(f,p)).setClearColor(.8,.8,1,1),g=new h(i.get("main.vs"),i.get("main.fs")),T=new h(i.get("main2.vs"),i.get("main2.fs"));let a=e.get("dragon");L=(new d).setIBO(new n(a.indices)).addVBO(new r(a.positions,3,g.getAttribLocation("position"))).addVBO(new r(a.normals,3,g.getAttribLocation("normale"))),a=e.get("blue_falcon"),R=new o(t.get("BLF1"),0),b=(new d).setIBO(new n(a.indices)).addVBO(new r(a.positions,3,T.getAttribLocation("position"))).addVBO(new r(a.normals,3,T.getAttribLocation("normale"))).addVBO(new r(a.texcoords,2,T.getAttribLocation("texcoords"))),S=new E(f,p).setSpeed(.05).setAcc(.005),_=u.identity(),I=[0,0,0],M=u.identity(),y()})();let v=0;const y=()=>{A.clear(),g.use(),g.sendMat4("camera",S.getMatrix()),u.identity(_),I[1]=5,I[0]=10*Math.sin(v),I[2]=10*Math.cos(v),_[12]=0,_[13]=0,_[14]=0,g.sendMat4("worldPosition",_),g.sendVec3("lightPos",I),L.draw(),u.fromRotation(M,-Math.PI/3,[0,0,1]),u.fromRotation(_,v+Math.PI/2,[0,1,0]),u.mult(_,_,M),T.use(),_[12]=I[0],_[13]=I[1],_[14]=I[2],T.sendMat4("camera",S.getMatrix()),T.sendMat4("worldPosition",_),R.use(),b.draw(),(v+=.02)>=2*Math.PI&&(v-=2*Math.PI),requestAnimationFrame(y)}}]);